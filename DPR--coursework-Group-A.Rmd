---
title: "DS202.3 - Treatment Response Prediction"
author: "Member 1 RKG Tharishika (ID), KADP Kumarapeli (36431)"
date: "2025-02-13"
output: html_document
---
# Problem Statement

#Import Libraries and Environment Setup 
```{r}
 library(tidyverse)
```

```{r}
library(lubridate)
library(scales)
```

#Loading Dataset
```{r}
raw_data <-read_tsv("msk_chord_2024_clinical_data.tsv")
```

```{r}
dim(raw_data)
```

```{r}
glimpse(raw_data)
```

# Problem definition
Can demographic variables and basic clinical features explain variation in treatment response patterns?

This notebook explores whether routinely collected demographic and clinical variables are associated with patterns of treatment response.

Because direct response measurements are unavailable, a composite *response proxy* is constructed using overall survival time, disease extent inferred from clinical notes, and recorded metastatic status.

The key variables considered include:
- Age
- Sex
- Cancer type
- Stage

# Data cleaning and selection

Raw clinical data are imported from a tab-separated file and restricted to patients with valid staging, clinical summaries, and survival outcomes.

Key demographic and disease variables are renamed for clarity, while additional features—such as binary stage grouping, inferred disease extent, age categories, and metastatic indicators—are engineered to support downstream analysis.

```{r}
data_clean <- raw_data %>%
  select(
    age = `Current Age`,
    sex = Sex,
    cancer_type = `Cancer Type`,
    stage = `Stage (Highest Recorded)`,
    clinical_summary = `Clinical Summary`,
    survival_months = `Overall Survival (Months)`,
    survival_status = `Overall Survival Status`,
    metastatic_site = `Metastatic Site`,
    sample_type = `Sample Type`,
    primary_site = `Primary Tumor Site`
  ) %>%
  filter(
    stage %in% c("Stage 1-3", "Stage 4"),
    !is.na(clinical_summary),
    !is.na(survival_months)
  ) %>%
  mutate(

    ## Binary stage
    stage_binary = ifelse(
      stage == "Stage 4",
      "Advanced",
      "Early"
    ),

    ## Disease extent inferred from notes
    disease_extent = case_when(
      str_detect(clinical_summary, "Distant|Metasta") ~ "Distant",
      str_detect(clinical_summary, "Regional") ~ "Regional",
      str_detect(clinical_summary, "Localized|In Situ") ~ "Localized",
      TRUE ~ "Other"
    ),

    ## Metastasis indicator
    has_metastasis = !is.na(metastatic_site) &
                     metastatic_site != "",

    ## Age groups
    age_group = cut(
      age,
      breaks = c(0, 50, 65, 100),
      labels = c("Under 50", "50–65", "Over 65"),
      include.lowest = TRUE
    ),

    ## Event indicator
    died = str_detect(survival_status, "DECEASED"),

    ## Simplified cancer categories
    cancer_simple = ifelse(
      cancer_type %in% c(
        "Breast Cancer",
        "Non-Small Cell Lung Cancer",
        "Colorectal Cancer",
        "Prostate Cancer",
        "Pancreatic Cancer"
      ),
      cancer_type,
      "Other"
    )
  )

cat("Final N:", nrow(data_clean))
```

#Summarized Missing Data
```{r}
raw_data %>%
  summarise(across(everything(),
                   ~mean(is.na(.))*100)) %>%
  pivot_longer(everything(),
               names_to = "variable",
               values_to = "pct_missing") %>%
  arrange(desc(pct_missing))

```

```{r}
cat("Initial N:", nrow(raw_data), "\n")
cat("After filtering:", nrow(data_clean), "\n")

```

The original dataset contains missing values, inconsistent variables, and unstructured clinical information that may reduce the accuracy of survival analysis.

Therefore, the data must be cleaned by selecting relevant variables, removing records with critical missing information, and transforming features into meaningful categories such as disease stage, age group, and metastasis status.

This process ensures a reliable and structured dataset for analyzing cancer survival outcomes.



 
